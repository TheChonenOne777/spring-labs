## Упражнение 8
### Управление транзакциями в Spring
#### Проект
_lab-8-tx_
#### Цели упражнения
Научиться использовать декларативное и программное управление транзакциями при
помощи Spring.
#### Описание
Spring предоставляет возможности для декларативного и программного управления
транзакциями. Также в Spring есть возможность интеграции с абстракциями для доступа к
данным через ORM или JDBC. В данном примере рассматривается управление транзакциями
на примере JDBC.
#### Задачи упражнения.
1. Создать `TransactionManager`, основанный на `DataSource`. Объявить
декларативную поддержку транзакций при помощи аннотаций;
2. Описать бин `countryService`. Сделать все методы класса `CountryServiceImpl`
транзакционными. Задать разные значения propagation для методов, в соответствии
с названиями методов (например, для метода `getAllCountriesRequired()` задать
значение `Propagation.REQUIRED`);
3. Протестировать разные варианты propagation для методов `CountryService` при
помощи теста `DeclarativeTransactionTestTest`. Сравнить поведение методов,
вызванных внутри и вне транзакции для разных значений propagation.
#### Подробное руководство
##### Часть 1. Создание TransactionManager’а
1. Откройте файл с конфигурацией `application-context.xml`;
2. Добавьте в него следующую конфигурацию:
```xml
<context:annotation-config/>
<context:component-scan base-package="lab.service" />
```
Какую роль выполняет каждая из этих строк?
3. Создайте бин transactionManager для класса `org.springframework.jdbc.datasource.DataSourceTransactionManager`.
Задайте ему ссылку на `DataSource`;
4. Добавьте строчку `<tx:annotation-driven />`, которая включает декларативную
поддержку транзакций при помощи аннотаций;
##### Часть 2. Конфигурация CountryServiceImpl
5. Создайте бин countryService для класса `CountryServiceImpl`;
6. Откройте класс `CountryServiceImpl`. Добавьте строчку `@Transactional` перед
описанием класса. Это делает все методы этого класса транзакционными с настройками
по умолчанию;
7. Чтобы изменить настройки для конкретных методов необходимо добавить описание
`@Transactional(readOnly = false, propagation = Propagation.REQUIRED)`
перед объявлением метода. Задайте соответствующие описания всем методам вида
`getAllCountriesRequired()`, изменяя только значение propagation в соответствии
с названием метода.
##### Часть 3. Тестирование декларативного описания транзакций
8. Каково должно быть поведение метода с propagation REQUIRED, вызванного
внутри или вне транзакции? C propagation MANDATORY?
9. Проверьте правильность при помощи теста `DeclarativeTransactionTest`.