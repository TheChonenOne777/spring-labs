## Упражнение 10
### Использование планирования задач
#### Проект
_lab-10-quartz_
#### Цели упражнения
Научиться запускать задачи по таймеру с использованием Quartz scheduler при
помощи Spring.
#### Описание
Spring предоставляет вспомогательное API для работы с таймерами, позволяя
настраивать их через конфигурационные файлы.
[Quartz scheduler](http://www.quartz-scheduler.org/) – сторонний продукт. Также
может быть запущен через определенные промежутки времени, но кроме этого предоставляет
возможность задать конкретный момент времени выполнения задачи (например, конкретная
дата или день недели.)
Spring позволяет настраивать эти планировщики через конфигурационные файлы, а
также избавляет от необходимости стартовать и останавливать таймер.
#### Задачи упражнения
1. Измените конфигурацию бина `schedulerFactoryBean` из `applicationcontext.xml`
и добавьте необходимые параметры для `reportTrigger` так, чтобы
задача `PrintingJob` выполнялась каждую секунду, начиная с пятой секунды от
момента запуска. Для проверки используйте тест `QuartzJobTest`, метод
`testRepeatableJob`;
2. Измените конфигурацию бина `schedulerFactoryBean` из `applicationcontext.xml`
и добавьте необходимые параметры для `reportTrigger` так, чтобы
задача `PrintingJob` выполнялась раз в три секунды только во время текущего часа,
в текущий день недели, в текущем месяце. Для проверки используйте тест
`QuartzCronJobTest`, метод `testCronJob`;
#### Подробное руководство
##### Часть 1. Новые возможности в Spring 3.1, облегчающие тестирование
1. Откройте файл с конфигурацией `application-context.xml`;
2. Обратите внимание на то, что в этом упражнении в файле `applicationcontext.xml`
появились нововведения, некоторые бины объявлены в блоках:
`<beans profile="interval">`, а классы юнит-тестов дополнительно проаннотированы
`@ActiveProfiles("interval")`. Таким образом, при выполнении конкретных
юнит-тестов будут подгружаться только бины, объявленные в рамках определенного
профиля;
3. Проанализируйте контекст! Как вы думаете, почему именно в этом упражнении мы
обратились к этой возможности?
4. Внимательно изучите комментарии к декларациям бинов – Spring 3.1 поддерживает
Quartz 2.*, в API которого произошли существенные изменения.
##### Часть 2. Конфигурация PrintingJob при помощи SimpleTriggerFactoryBean
5. Откройте класс `PrintingJob`. Проанализируйте его. От какого класса он
унаследован? Какие методы переопределены?
6. Найдите блок объявления бинов для профиля «interval»;
7. Добавьте следующие свойства для бина schedulerFactoryBean
```xml
<property name="triggers">
  <list>
    <ref bean="reportTrigger" />
  </list>
</property>
```
8. Задайте конфигурацию для бина reportTrigger, добавив необходимые свойства:
```xml
<property name="jobDetail" ref="reportJob" />
<property name="repeatInterval" value="1000" />
<property name="startDelay" value="5000" />
```
9. Что означает каждое из этих свойств?
10. Выполните тест `QuartzJobTest`, метод `testRepeatableJob`;
##### Часть 3. Конфигурация PrintingJob при помощи CronReportTrigger из Quartz Scheduler
11. Найдите блок объявления бинов для профиля «cron»  
Задайте конфигурацию для бина reportTrigger, добавив необходимые свойства:
```xml
<property name="jobDetail" ref="reportJob" />
<property name="cronExpression" value="0/3 * * ? m dw" />
```
12. вместо m подставьте номер текущего месяца, вместо dw номер текущего дня недели (где
1- воскресенье, 2 – понедельник и т.д.);
13. Что означает каждое из этих свойств?
14. Что означает каждый из параметров `cronExpression`?
15. Выполните тест `QuartzCronJobTest`;
##### Часть 4. Использование аннотаций для планирования задач
1. Откройте `application-context-ad.xml` – изучите конфигурацию и новые
возможности, которые предоставляет Spring для планирования задач с помощью
аннотаций;
2. Откройте класс `ScheduledTask`, изучите код. Каким образом Spring определяет , что
метод `doSomething()` должен выполняться планировщиком?
3. Выполните тест `ScheduledTest`, метод `testRepeatableJob()`;