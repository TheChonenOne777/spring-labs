## Упражнение 5
### Использование Spring AOP. @AspectJ style
#### Проект
_lab-5-aop_
#### Цели упражнения
Научиться использовать Spring AOP с применением подхода @AspectJ style на примере
Before, After и Around advice’ов.
#### Описание
Существует два основных подхода использования AOP в Spring: @AspectJ style и
Schema-based. Подход @AspectJ может быть использован начиная с JDK 5. Также при
использовании этого подхода все описания делаются аннотациями, т.е. находятся внутри кода.
В этом случае, нет возможности использовать в качестве advice’ов или pointcut’ов классы из
сторонних библиотек.
#### Задачи упражнения
1. На примере Before advice и After returning advice (класс `Politeness`)
создайте остальные типы After advice’ов для метода `sellSquishee(…)`
из класса `ApuBar` с использованием подхода @AspectJ.
Проверьте правильность выполнения при помощи теста `AopAspectJTest`;
2. Создать Around advice для метода `sellSquishee(…)` с использованием подхода
@AspectJ. Проверьте правильность выполнения при помощи теста `AopAspectJTest `;
Подробное руководство.
##### Часть 1. Создание after advice’ов
1. Откройте проект _lab-5-aop_;
2. Откройте файл с конфигурацией `application-context.xml`. Добавить строчку
`<aop:aspectj-autoproxy/>`. Это указание на то, что все описания аспектов
будут находиться в декларациях;
3. Откройте класс `Politeness`. Что значат параметры в аннотации методов
`sayHello` и `askOpinion`? Как в методе `askOpinion` получено название проданного
напитка?
4. Создайте advice на базе метода `sayGoodBye`, который выполнится, после попытки
продать напиток в любом случае. (After). Для этого необходимо добавить строчку
`@After("execution(* sellSquishee(..))")` перед объявлением метода.
5. Запустите тест `AopAspectJTest` для разных конфигураций `Customer` (есть у него
деньги или нет – параметр `broke`). В каком случае какой из тестов
`testAfterReturningAdvice` выполнится правильно?
#### Часть 2. Создание around advice’а
6. Создайте Around advice для метода `sellSquishee` таким образом, чтоб в нем был
вызов target-метода. За основу возьмите метод `sayPoliteWordsAndSell`. Для
этого необходимо добавить строчку `@Around("execution(* sellSquishee(..))")`
перед объявлением метода;
7. Для проверки запустите тест `testAroundAdvice`.
8. Можно ли в around advice’е не вызывать target-метод?
#### Часть 3. Создание after throwing advice’ов
9. Создайте advice на базе метода `sayYouAreNotAllowed`, который выполнится,
если у клиента нет денег, т.е в случае, когда выбросится исключение
`CustomerBrokenException` (After throwing). Для этого необходимо
добавить строчку `@AfterThrowing("execution(* sellSquishee(..))")`
перед объявлением метода;
10. Откройте `application-context.xml`, модифицируйте его так, чтобы у Клиента
“не было денег”;
11. Откройте класс `AopAspectJExceptionTest` и выполните юнит-тест;